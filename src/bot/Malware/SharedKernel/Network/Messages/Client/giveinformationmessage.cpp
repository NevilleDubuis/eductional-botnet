#include <thread>

#include <QHostInfo>
#include <QSysInfo>

#include "giveinformationmessage.h"

namespace network { namespace messages { namespace client
{    
    GiveInformationMessage::GiveInformationMessage()
        : ClientMessage(ClientOpcode::GiveInformation),
          computerName_(QHostInfo::localHostName()),
          cpu_(std::thread::hardware_concurrency()),
          operatingSystem_(getOperatingSystemInfo())

    {
    }

    QString GiveInformationMessage::getOperatingSystemInfo()
    {
        return QSysInfo::prettyProductName() + "; " + QSysInfo::buildCpuArchitecture();
    }

    QJsonObject GiveInformationMessage::toJson()
    {
        QJsonObject json = ClientMessage::toJson();
        QJsonObject payload = json["payload"].toObject();

        payload["computerName"] = computerName_;
        payload["cpu"] = (int)cpu_;
        payload["operatingSystem"] = operatingSystem_;
        json["payload"] = payload;

        return json;
    }
}}}
