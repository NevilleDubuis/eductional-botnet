#include "tst_modulerepositorytests.h"

void ModuleRepositoryTests::initTestCase()
{
    this->repo_ = new systems::windows::WindowsModuleRepository();
    this->processRepo_ = new systems::windows::WindowsProcessRepository();
}

void ModuleRepositoryTests::cleanupTestCase()
{
    delete this->repo_;
    delete this->processRepo_;
}

void ModuleRepositoryTests::getAllModulesForProcess_CheckForKernel32InItself_ShouldExist()
{
    // Arrange
    auto currentProcess = this->processRepo_->getCurrentProcess();

    // Act
    auto modules = this->repo_->getAllModulesForProcess(currentProcess);

    // Assert
    bool isKernel32Found = false;

    for(auto& m : modules)
    {
        if(m == "KERNEL32.DLL")
        {
            isKernel32Found = true;
            break;
        }
    }

    QVERIFY2(isKernel32Found, "Kernel32 must be loaded in the current process.");
}
